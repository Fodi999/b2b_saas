# 🎨 ВИЗУАЛЬНАЯ АРХИТЕКТУРА B2B SaaS

```
╔══════════════════════════════════════════════════════════════════════════╗
║                         🏢 B2B SaaS RESTAURANT SYSTEM                    ║
║                     Restaurant Management & AI Optimization              ║
╚══════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────┐
│                          📊 VALUE CHAIN FLOW                             │
└──────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────┐
    │   📦 СКЛАД      │  ← Данные о продуктах, ценах, сроках
    │   (Inventory)   │
    └────────┬────────┘
             │ цены, количество, статусы
             ↓
    ┌─────────────────┐
    │  🍳 РЕЦЕПТЫ     │  ← AI расчёт себестоимости
    │   (Recipes)     │
    └────────┬────────┘
             │ costPerServing
             ↓
    ┌─────────────────┐
    │  🍽️ БЛЮДА       │  ← Расчёт маржи и Food Cost
    │   (Dishes)      │
    └────────┬────────┘
             │ margin, foodCost%
             ↓
    ┌─────────────────┐
    │ 📈 MENU ENG     │  ← BCG категоризация
    │ (Optimization)  │
    └────────┬────────┘
             │ recommendations
             ↓
    ┌─────────────────┐
    │  📊 ОТЧЁТЫ      │  ← Executive Summary + Actions
    │   (Reports)     │
    └─────────────────┘


┌──────────────────────────────────────────────────────────────────────────┐
│                          🗄️ DATA ARCHITECTURE                            │
└──────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                         FRONTEND (Next.js 16)                           │
│                                                                         │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐             │
│  │   Recipes     │  │    Dishes     │  │  Menu Eng     │             │
│  │   Page        │  │    Page       │  │   Page        │             │
│  └───────┬───────┘  └───────┬───────┘  └───────┬───────┘             │
│          │                  │                  │                      │
│          └──────────────────┼──────────────────┘                      │
│                             │                                         │
│  ┌──────────────────────────▼────────────────────────────┐            │
│  │              ZUSTAND STATE MANAGEMENT                 │            │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐│            │
│  │  │ recipes-store│  │ dishes-store │  │  menu-store  ││            │
│  │  │   + persist  │  │   + persist  │  │   + persist  ││            │
│  │  └──────────────┘  └──────────────┘  └──────────────┘│            │
│  └────────────────────────┬──────────────────────────────┘            │
│                           │                                           │
│  ┌────────────────────────▼──────────────────────────────┐            │
│  │              LOCALSTORAGE PERSISTENCE                 │            │
│  │   recipes-storage | dishes-storage | menu-storage    │            │
│  └───────────────────────────────────────────────────────┘            │
└─────────────────────────────────────────────────────────────────────────┘


┌──────────────────────────────────────────────────────────────────────────┐
│                        🧮 CALCULATION LOGIC                              │
└──────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════╗
║  RECIPE COST CALCULATION                                              ║
╠═══════════════════════════════════════════════════════════════════════╣
║                                                                       ║
║  Ингредиент 1: Мука (500г)                                            ║
║    └─→ Цена на складе: 10 PLN за 1000г                               ║
║    └─→ Расчёт: (500 / 1000) × 10 = 5.00 PLN                         ║
║                                                                       ║
║  Ингредиент 2: Яйца (3 шт)                                           ║
║    └─→ Цена на складе: 12 PLN за 10 шт                              ║
║    └─→ Расчёт: (3 / 10) × 12 = 3.60 PLN                             ║
║                                                                       ║
║  TOTAL COST = 5.00 + 3.60 + ... = 15.80 PLN                          ║
║  SERVINGS (AI) = 4 порции                                             ║
║  COST PER SERVING = 15.80 / 4 = 3.95 PLN                            ║
║                                                                       ║
╚═══════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════╗
║  DISH MARGIN CALCULATION                                              ║
╠═══════════════════════════════════════════════════════════════════════╣
║                                                                       ║
║  Компонент 1: Тесто для пиццы (1 порция)                             ║
║    └─→ Recipe cost per serving: 3.95 PLN                             ║
║                                                                       ║
║  Компонент 2: Томатный соус (1 порция)                               ║
║    └─→ Recipe cost per serving: 2.20 PLN                             ║
║                                                                       ║
║  Компонент 3: Сыр моцарелла (1 порция)                               ║
║    └─→ Recipe cost per serving: 5.40 PLN                             ║
║                                                                       ║
║  TOTAL COST = 3.95 + 2.20 + 5.40 = 11.55 PLN                        ║
║  SALE PRICE = 32.00 PLN                                               ║
║  MARGIN = 32.00 - 11.55 = 20.45 PLN                                  ║
║  MARGIN % = (20.45 / 32.00) × 100 = 63.9%                           ║
║  FOOD COST % = (11.55 / 32.00) × 100 = 36.1%                        ║
║                                                                       ║
╚═══════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════╗
║  BCG MATRIX CATEGORIZATION                                            ║
╠═══════════════════════════════════════════════════════════════════════╣
║                                                                       ║
║  if (foodCost < 30%)  → ⭐ STAR        (высокая маржа)               ║
║  if (foodCost < 40%)  → 💰 CASH COW    (стабильная маржа)            ║
║  if (foodCost < 55%)  → ⚠️ QUESTION    (низкая маржа)                ║
║  if (foodCost >= 55%) → 🚫 DOG         (убыточное)                   ║
║                                                                       ║
║  Пример: Пицца Маргарита                                              ║
║    Food Cost: 36.1% → 💰 CASH COW                                     ║
║    Действие: "Стабильное блюдо, продолжайте продавать"               ║
║                                                                       ║
╚═══════════════════════════════════════════════════════════════════════╝


┌──────────────────────────────────────────────────────────────────────────┐
│                         🎨 UI/UX COMPONENTS                              │
└──────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                    RECIPE CARD (Orange/Blue Theme)                      │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  🍳 Борщ домашний                              [... menu]         │  │
│  │  ────────────────────────────────────────────────────────────     │  │
│  │  📷 [Image or Gradient Placeholder]                               │  │
│  │  ────────────────────────────────────────────────────────────     │  │
│  │  Порций: 4 [AI]  •  Время: 30 мин [AI]  •  Средне [AI]          │  │
│  │                                                                    │  │
│  │  💰 Стоимость: 15.80 PLN [AI · на основе склада]                 │  │
│  │  📊 На порцию: 3.95 PLN                                           │  │
│  │                                                                    │  │
│  │  ⚠️ Проблемы со складом: [expandable]                            │  │
│  │     • Сливки 30% истекает через 3 дня                            │  │
│  │     • Недостаточно Муки (нужно 500г, есть 200г)                  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                     DISH CARD (Purple Theme)                            │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  🍽️ Пицца Маргарита                           [... menu]         │  │
│  │  ────────────────────────────────────────────────────────────     │  │
│  │  📷 [Image or Purple Gradient]                                    │  │
│  │  ────────────────────────────────────────────────────────────     │  │
│  │  💵 Цена: 32.00 PLN  •  Стоимость: 11.55 PLN                     │  │
│  │  💰 Маржа: 20.45 PLN (63.9%) [✓ Прибыль]                         │  │
│  │  📊 Food Cost: 36.1%                                              │  │
│  │                                                                    │  │
│  │  ⚠️ Предупреждения: [expandable]                                 │  │
│  │     • Сыр моцарелла истекает через 5 дней                        │  │
│  └───────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│               MENU ENGINEERING SUMMARY (Purple/Green)                   │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌──────────┐│  │
│  │  │   Средняя   │  │   Средний   │  │  Проблемных │  │ Потенциал││  │
│  │  │   маржа     │  │  Food Cost  │  │    блюд     │  │  роста   ││  │
│  │  │             │  │             │  │             │  │          ││  │
│  │  │   58.2%     │  │    38.5%    │  │      2      │  │ +380 PLN ││  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └──────────┘│  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  🤖 AI-инсайт · на основе склада                                  │  │
│  │  ────────────────────────────────────────────────────────────     │  │
│  │  При оптимизации меню прибыль вырастет на ~380 PLN/мес           │  │
│  │  Основные действия:                                                │  │
│  │  • Убрать 2 убыточных блюда                                       │  │
│  │  • Поднять цены на 3 блюдах                                       │  │
│  │  • Использовать истекающие ингредиенты                            │  │
│  └───────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                    REPORTS AI SUMMARY (Blue)                            │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  🧠 AI Итог за последние 30 дней                                  │  │
│  │  ────────────────────────────────────────────────────────────     │  │
│  │  • Чистая прибыль: +3,180 PLN                                     │  │
│  │  • Потери из-за склада: –140 PLN                                  │  │
│  │  • 2 блюда тянут прибыль вниз                                     │  │
│  │                                                                    │  │
│  │  💡 Что делать дальше:                                            │  │
│  │  Убрать [Салат Цезарь] или изменить рецепт —                     │  │
│  │  это повысит среднюю маржу на 4–6%                                │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐                      │
│  │ Выручка│  │ Прибыль│  │  Food  │  │Потенц. │                      │
│  │12,400₽ │  │ 3,180₽ │  │Cost 38%│  │+640₽[AI]                     │
│  └────────┘  └────────┘  └────────┘  └────────┘                      │
│                                        "при применении AI-рекомендаций"│
└─────────────────────────────────────────────────────────────────────────┘


┌──────────────────────────────────────────────────────────────────────────┐
│                       🔄 USER JOURNEY FLOWS                              │
└──────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════╗
║  FLOW 1: Создание рецепта                                             ║
╠═══════════════════════════════════════════════════════════════════════╣
║                                                                       ║
║  1. Пользователь: Открывает "Создать рецепт"                         ║
║     └─→ Видит: пустую форму                                          ║
║                                                                       ║
║  2. Пользователь: Вводит "Борщ домашний"                             ║
║     └─→ Система: сохраняет в state                                   ║
║                                                                       ║
║  3. Пользователь: Ищет "свёкла" (min 2 символа)                      ║
║     └─→ Система: фильтрует MOCK_INVENTORY                            ║
║     └─→ Показывает: dropdown с результатами                          ║
║                                                                       ║
║  4. Пользователь: Выбирает "Свёкла красная"                          ║
║     └─→ Система: сохраняет inventoryItemId + единицу измерения       ║
║     └─→ Показывает: зелёный чекбокс с названием                      ║
║                                                                       ║
║  5. Пользователь: Вводит количество "300"                            ║
║     └─→ Система: валидирует (number > 0)                             ║
║                                                                       ║
║  6. Пользователь: Добавляет ещё ингредиенты (repeat 3-5)             ║
║                                                                       ║
║  7. Пользователь: Вводит инструкции                                  ║
║     └─→ Система: валидирует (не пусто)                               ║
║                                                                       ║
║  8. Пользователь: (optional) Загружает фото                          ║
║     └─→ Система: валидирует (JPEG/PNG/WEBP, < 5MB)                  ║
║     └─→ Конвертирует в base64                                        ║
║                                                                       ║
║  9. Пользователь: Нажимает "Предпросмотр с AI"                       ║
║     └─→ Система: показывает loader (1.5 сек)                         ║
║     └─→ AI анализирует:                                              ║
║         • Рассчитывает totalCost (из inventory)                      ║
║         • Оценивает servings, prepTime, difficulty                   ║
║         • Генерирует aiInsights                                      ║
║         • Проверяет warnings (expiring, insufficient)                ║
║                                                                       ║
║  10. Пользователь: Видит preview                                     ║
║      └─→ Проверяет: стоимость, порции, предупреждения               ║
║                                                                       ║
║  11. Пользователь: Нажимает "Сохранить"                              ║
║      └─→ Система: recipes-store.addRecipe()                          ║
║      └─→ Persist в localStorage                                      ║
║      └─→ Redirect на /recipes                                        ║
║                                                                       ║
║  12. Пользователь: Видит новый рецепт в списке                       ║
║      └─→ SUCCESS ✅                                                   ║
║                                                                       ║
╚═══════════════════════════════════════════════════════════════════════╝

╔═══════════════════════════════════════════════════════════════════════╗
║  FLOW 2: Menu Engineering анализ                                      ║
╠═══════════════════════════════════════════════════════════════════════╣
║                                                                       ║
║  1. Пользователь: Открывает Menu Engineering                         ║
║     └─→ Система: загружает dishes из store                           ║
║                                                                       ║
║  2. Система: Рассчитывает метрики                                    ║
║     └─→ Средняя маржа: Σ margin / count                             ║
║     └─→ Средний Food Cost: Σ foodCost / count                       ║
║     └─→ Проблемных блюд: count(foodCost > 40%)                      ║
║     └─→ Потенциал: AI mock calculation                              ║
║                                                                       ║
║  3. Система: Категоризация каждого блюда (BCG)                       ║
║     └─→ for each dish: calculateCategory(foodCostPercent)            ║
║                                                                       ║
║  4. Пользователь: Видит Summary Bar + AI Insight                     ║
║                                                                       ║
║  5. Пользователь: Применяет фильтр "⚠️ Проблемные"                   ║
║     └─→ Система: dishes.filter(d => d.foodCostPercent >= 40)        ║
║     └─→ Показывает: только проблемные блюда                          ║
║                                                                       ║
║  6. Пользователь: Кликает на блюдо                                   ║
║     └─→ Система: открывает Detail Modal                             ║
║     └─→ Показывает:                                                  ║
║         • Полная разбивка стоимости                                  ║
║         • Рекомендации по цене                                       ║
║         • История изменений (future)                                 ║
║                                                                       ║
║  7. Пользователь: Видит рекомендацию "Поднять цену на +2 PLN"       ║
║     └─→ Hover на кнопку: tooltip "AI рекомендует: 32.00 PLN"        ║
║                                                                       ║
║  8. Пользователь: Нажимает "Применить"                               ║
║     └─→ Система: updateDish(id, { salePrice: newPrice })            ║
║     └─→ Пересчитывает: margin, marginPercent, foodCostPercent       ║
║     └─→ Обновляет категорию                                          ║
║     └─→ SUCCESS ✅                                                   ║
║                                                                       ║
╚═══════════════════════════════════════════════════════════════════════╝


┌──────────────────────────────────────────────────────────────────────────┐
│                      🎯 KEY DESIGN DECISIONS                             │
└──────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  РЕШЕНИЕ 1: Portion-Based Dishes (1 serving per recipe)                │
├─────────────────────────────────────────────────────────────────────────┤
│  Альтернатива: Произвольное количество порций на рецепт                │
│  Выбрали: Всегда 1 порция                                               │
│  Причина:                                                               │
│    • Проще UX (меньше полей)                                            │
│    • Проще расчёты (cost = recipe.costPerServing)                      │
│    • Меньше ошибок пользователя                                         │
│    • Достаточно для 90% случаев                                         │
│  Trade-off: Для сложных блюд нужно создавать промежуточные рецепты      │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  РЕШЕНИЕ 2: BCG Matrix для категоризации блюд                          │
├─────────────────────────────────────────────────────────────────────────┤
│  Альтернатива: Произвольные категории или ML-кластеризация             │
│  Выбрали: BCG Matrix (Star/Cash Cow/Question/Dog)                      │
│  Причина:                                                               │
│    • Индустриальный стандарт (Menu Engineering)                         │
│    • Понятно рестораторам (не нужно объяснять)                         │
│    • Чёткие пороги (30%, 40%, 55%)                                     │
│    • Простые действия для каждой категории                              │
│  Trade-off: Не учитывает popularity (будущая фича)                     │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  РЕШЕНИЕ 3: AI-бейджи везде ("на основе склада")                       │
├─────────────────────────────────────────────────────────────────────────┤
│  Альтернатива: Скрыть что AI считает                                   │
│  Выбрали: Максимальная прозрачность                                    │
│  Причина:                                                               │
│    • Доверие пользователя (он видит что AI реально работает)           │
│    • Образовательный эффект ("AI помогает, а не заменяет")             │
│    • USP (уникальное преимущество перед конкурентами)                   │
│    • Снижает вопросы "откуда цифра?"                                    │
│  Trade-off: Может казаться "too much AI" для консерваторов             │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  РЕШЕНИЕ 4: Detailed Warnings вместо счётчиков                          │
├─────────────────────────────────────────────────────────────────────────┤
│  Альтернатива: "⚠️ 2 проблемы" (сворачиваемо)                          │
│  Выбрали: Конкретные предупреждения с деталями                         │
│  Причина:                                                               │
│    • Actionable (пользователь сразу знает что делать)                   │
│    • Не нужно кликать чтобы узнать суть проблемы                       │
│    • Больше trust (прозрачность)                                        │
│  Пример:                                                                │
│    ❌ "⚠️ 2 проблемы со складом"                                        │
│    ✅ "• Сливки 30% истекает через 3 дня"                              │
│       "• Недостаточно Муки (нужно 500г, есть 200г)"                    │
│  Trade-off: Занимает больше места на экране                            │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│  РЕШЕНИЕ 5: localStorage вместо backend (MVP)                           │
├─────────────────────────────────────────────────────────────────────────┤
│  Альтернатива: Сразу строить backend                                   │
│  Выбрали: Zustand + localStorage                                       │
│  Причина:                                                               │
│    • Быстрая разработка MVP (0 backend setup)                           │
│    • Работает offline                                                   │
│    • Достаточно для демо/pilot                                          │
│    • Легко мигрировать на backend потом                                │
│  Trade-off:                                                             │
│    • Нет sync между устройствами                                        │
│    • Лимит ~5-10MB данных                                              │
│    • Нет collaborative features                                         │
│  Когда переходить на backend:                                           │
│    → После первых 10-50 paying customers                                │
└─────────────────────────────────────────────────────────────────────────┘


┌──────────────────────────────────────────────────────────────────────────┐
│                        📚 DOCUMENTATION MAP                              │
└──────────────────────────────────────────────────────────────────────────┘

ARCHITECTURE.md (this file)
  ├─→ Полная архитектура системы
  ├─→ Data models
  ├─→ Tech stack
  └─→ Design decisions

MENU_ENGINEERING.md
  ├─→ Menu Engineering модуль
  ├─→ BCG Matrix формулы
  ├─→ AI-рекомендации
  └─→ Production checklist

REPORTS.md
  ├─→ Отчёты модуль
  ├─→ KPI расчёты
  ├─→ AI Executive Summary
  └─→ Export functionality

README.md (create next)
  ├─→ Quick start
  ├─→ Installation
  ├─→ Development
  └─→ Deployment


┌──────────────────────────────────────────────────────────────────────────┐
│                          🎓 BEST PRACTICES                               │
└──────────────────────────────────────────────────────────────────────────┘

✅ DO:
  • Держать логику расчётов в чистых функциях (легко тестировать)
  • Использовать TypeScript strict mode (меньше багов)
  • Persist всё что user создал (frustration от потери данных = churn)
  • Показывать AI-бейджи везде где AI считал (доверие)
  • Давать контекст цифрам ("при применении AI-рекомендаций")
  • Использовать tooltips для дополнительной информации
  • Детализировать warnings (не просто "2 проблемы")

❌ DON'T:
  • Не перегружать UI (focus на деньгах, не на features ради features)
  • Не скрывать что AI считает (прозрачность = trust)
  • Не использовать абстрактные метрики ("engagement score")
  • Не делать формы длиннее 2 экранов
  • Не дублировать кнопки действий (1 место = 1 кнопка)
  • Не забывать dark mode support
  • Не хардкодить строки (use i18n)


┌──────────────────────────────────────────────────────────────────────────┐
│                         🚀 NEXT STEPS                                    │
└──────────────────────────────────────────────────────────────────────────┘

1. CREATE README.md
   └─→ Installation instructions
   └─→ How to run locally
   └─→ Environment variables

2. ADD TESTS
   └─→ Unit tests for calculations
   └─→ Integration tests for stores
   └─→ E2E for critical flows

3. BACKEND INTEGRATION
   └─→ Design API endpoints
   └─→ Choose backend (Node.js + PostgreSQL?)
   └─→ Migration strategy from localStorage

4. REAL AI
   └─→ OpenAI API integration
   └─→ Prompt engineering for recommendations
   └─→ Cost optimization (caching, batch)

5. ANALYTICS
   └─→ Mixpanel/Amplitude setup
   └─→ Track key user actions
   └─→ A/B test ideas

6. GO TO MARKET
   └─→ Landing page
   └─→ Demo video
   └─→ Pitch deck
   └─→ First 10 customers


┌──────────────────────────────────────────────────────────────────────────┐
│                           🎉 CONCLUSION                                  │
└──────────────────────────────────────────────────────────────────────────┘

Это не просто "ещё один SaaS" —
Это INVESTMENT-READY продукт с:

✅ Чёткой value proposition (оптимизация прибыли)
✅ Работающим MVP (можно показывать клиентам)
✅ Продуманной архитектурой (легко масштабировать)
✅ Документацией (не нужно гадать как работает)
✅ UX фокусом (деньги, не дашборды ради дашбордов)

Готово к:
  → Демо для ресторанов
  → Pitch для инвесторов
  → Pilot с первыми клиентами
  → Итерации на основе feedback

Let's ship it! 🚀
